<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Replacebook - Advanced Search Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .search-form {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }
        .search-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .search-field {
            display: flex;
            flex-direction: column;
        }
        label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        input[type="text"], input[type="number"], select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .search-button {
            grid-column: span 2;
            padding: 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        .search-button:hover {
            background: #0056b3;
        }
        .search-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .results {
            margin-top: 20px;
        }
        .result-item {
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            margin-bottom: 10px;
            background: #fafafa;
        }
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .result-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        .result-wealth {
            font-size: 16px;
            color: #28a745;
            font-weight: 500;
        }
        .result-meta {
            display: flex;
            gap: 20px;
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        .result-snippet {
            font-size: 14px;
            line-height: 1.5;
            color: #444;
        }
        .result-snippet mark {
            background: #ffeb3b;
            padding: 2px;
            border-radius: 2px;
        }
        .relevance-score {
            font-size: 12px;
            color: #999;
        }
        .autocomplete-container {
            position: relative;
        }
        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 4px 4px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
        }
        .autocomplete-item {
            padding: 10px;
            cursor: pointer;
        }
        .autocomplete-item:hover {
            background: #f0f0f0;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .stats {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>The Replacebook - Advanced Search</h1>
        
        <form id="searchForm" class="search-form">
            <div class="search-field">
                <label for="query">Search in biographies, achievements, and more:</label>
                <input type="text" id="query" name="query" placeholder="e.g., 'artificial intelligence', 'philanthropy', 'founded'">
            </div>
            
            <div class="search-row">
                <div class="search-field">
                    <label for="industry">Industry:</label>
                    <input type="text" id="industry" name="industry" placeholder="e.g., Technology, Finance">
                </div>
                
                <div class="search-field">
                    <label for="country">Country:</label>
                    <input type="text" id="country" name="country" placeholder="e.g., United States, China">
                </div>
            </div>
            
            <div class="search-row">
                <div class="search-field autocomplete-container">
                    <label for="company">Company:</label>
                    <input type="text" id="company" name="company" placeholder="e.g., Tesla, Amazon" autocomplete="off">
                    <div id="companySuggestions" class="autocomplete-suggestions"></div>
                </div>
                
                <div class="search-field">
                    <label>Net Worth Range (Billions):</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="number" id="minWealth" name="minWealth" placeholder="Min" min="0" step="0.1">
                        <input type="number" id="maxWealth" name="maxWealth" placeholder="Max" min="0" step="0.1">
                    </div>
                </div>
            </div>
            
            <button type="submit" class="search-button">Search Billionaires</button>
        </form>
        
        <div id="error" class="error" style="display: none;"></div>
        
        <div id="stats" class="stats"></div>
        
        <div id="results" class="results"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        
        // Form submission
        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            performSearch();
        });
        
        async function performSearch() {
            const formData = new FormData(document.getElementById('searchForm'));
            const params = new URLSearchParams();
            
            // Build query parameters
            if (formData.get('query')) params.append('q', formData.get('query'));
            if (formData.get('industry')) params.append('industry', formData.get('industry'));
            if (formData.get('country')) params.append('country', formData.get('country'));
            if (formData.get('company')) params.append('company', formData.get('company'));
            if (formData.get('minWealth')) params.append('min_wealth', formData.get('minWealth'));
            if (formData.get('maxWealth')) params.append('max_wealth', formData.get('maxWealth'));
            
            // Show loading
            document.getElementById('results').innerHTML = '<div class="loading">Searching...</div>';
            document.getElementById('error').style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE}/search?${params}`);
                const data = await response.json();
                
                if (data.success) {
                    displayResults(data.data);
                } else {
                    showError(data.error || 'Search failed');
                }
            } catch (err) {
                showError('Network error: ' + err.message);
            }
        }
        
        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            const statsDiv = document.getElementById('stats');
            
            if (results.length === 0) {
                resultsDiv.innerHTML = '<div class="loading">No results found</div>';
                statsDiv.textContent = '';
                return;
            }
            
            statsDiv.textContent = `Found ${results.length} results`;
            
            resultsDiv.innerHTML = results.map(result => `
                <div class="result-item">
                    <div class="result-header">
                        <span class="result-name">${result.billionaire.name}</span>
                        <span class="result-wealth">$${result.billionaire.net_worth.toFixed(1)}B</span>
                    </div>
                    <div class="result-meta">
                        <span>üè¢ ${result.billionaire.industry || 'Unknown'}</span>
                        <span>üåç ${result.billionaire.country || 'Unknown'}</span>
                        ${result.billionaire.company ? `<span>üíº ${result.billionaire.company}</span>` : ''}
                    </div>
                    ${result.highlight_snippets.length > 0 ? 
                        result.highlight_snippets.map(snippet => `
                            <div class="result-snippet">
                                <strong>${snippet.field}:</strong> ...${snippet.snippet}...
                            </div>
                        `).join('') : 
                        result.billionaire.bio ? 
                            `<div class="result-snippet">${result.billionaire.bio.substring(0, 200)}...</div>` :
                            ''
                    }
                    <div class="relevance-score">Relevance: ${(result.relevance_score * 100).toFixed(1)}%</div>
                </div>
            `).join('');
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('results').innerHTML = '';
        }
        
        // Company autocomplete
        let autocompleteTimeout;
        const companyInput = document.getElementById('company');
        const suggestionsDiv = document.getElementById('companySuggestions');
        
        companyInput.addEventListener('input', (e) => {
            clearTimeout(autocompleteTimeout);
            const value = e.target.value.trim();
            
            if (value.length < 2) {
                suggestionsDiv.style.display = 'none';
                return;
            }
            
            autocompleteTimeout = setTimeout(() => {
                fetchAutocompleteSuggestions(value);
            }, 300);
        });
        
        async function fetchAutocompleteSuggestions(query) {
            try {
                const response = await fetch(`${API_BASE}/autocomplete?q=${encodeURIComponent(query)}&field=company`);
                const data = await response.json();
                
                if (data.success && data.data.suggestions.length > 0) {
                    displaySuggestions(data.data.suggestions);
                } else {
                    suggestionsDiv.style.display = 'none';
                }
            } catch (err) {
                console.error('Autocomplete error:', err);
                suggestionsDiv.style.display = 'none';
            }
        }
        
        function displaySuggestions(suggestions) {
            suggestionsDiv.innerHTML = suggestions.map(suggestion => 
                `<div class="autocomplete-item" onclick="selectSuggestion('${suggestion}')">${suggestion}</div>`
            ).join('');
            suggestionsDiv.style.display = 'block';
        }
        
        function selectSuggestion(value) {
            companyInput.value = value;
            suggestionsDiv.style.display = 'none';
        }
        
        // Hide suggestions when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.autocomplete-container')) {
                suggestionsDiv.style.display = 'none';
            }
        });
        
        // Example searches
        const examples = [
            { query: 'artificial intelligence', label: 'AI and Technology' },
            { query: 'philanthropy', label: 'Charitable Giving' },
            { query: 'founded', label: 'Company Founders' },
            { query: 'education harvard', label: 'Harvard Alumni' }
        ];
        
        // You can add example search buttons here if desired
    </script>
</body>
</html>